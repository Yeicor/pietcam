function t(t,e){if(!t)throw e||"Assertion failed"}class e{constructor(r,a,n=new Uint8ClampedArray(r*a*3),i=!0){this.toImageWithAlpha=()=>{let t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e++)t[4*e]=this.data[3*e],t[4*e+1]=this.data[3*e+1],t[4*e+2]=this.data[3*e+2],t[4*e+3]=255;return new e(this.width,this.height,t,!1)},this.width=r,this.height=a,i&&t(n.length===r*a*3,`data.length (${n.length}) != width * height * 3 (${r*a*3})`),this.data=n}static #t=(()=>{this.fromImageWithAlpha=(r,a,n)=>{t(n.length===r*a*4,`data.length (${n.length}) != width * height * 4 (${r*a*4})`);let i=new Uint8ClampedArray(r*a*3);for(let t=0;t<i.length;t++)i[3*t]=n[4*t],i[3*t+1]=n[4*t+1],i[3*t+2]=n[4*t+2];return new e(r,a,i)}})();index(t,e){if(t<0||t>=this.width||e<0||e>=this.height)throw Error(`(${t}, ${e}) is out of bounds, image is ${this.width}x${this.height}`);return 3*(e*this.width+t)}getPixel(t,e){let r=this.index(t,e);return[this.data[r],this.data[r+1],this.data[r+2]]}setPixel(t,e,r){let a=this.index(t,e);this.data[a]=r[0],this.data[a+1]=r[1],this.data[a+2]=r[2]}}const r=[0,0,0],a=[255,255,255];class n{static createEmpty(t,e){return new n(new Uint8ClampedArray(t*e),t)}constructor(t,e){this.width=e,this.height=t.length/e,this.data=t}get(t,e){return!(t<0)&&!(t>=this.width)&&!(e<0)&&!(e>=this.height)&&!!this.data[e*this.width+t]}set(t,e,r){this.data[e*this.width+t]=r?1:0}setRegion(t,e,r,a,n){for(let i=e;i<e+a;i++)for(let e=t;e<t+r;e++)this.set(e,i,!!n)}}class i{constructor(t,e){this.width=t,this.data=new Uint8ClampedArray(t*e)}get(t,e){return this.data[e*this.width+t]}set(t,e,r){this.data[e*this.width+t]=r}}const o=(t,e)=>Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2);function l(t){return t.reduce((t,e)=>t+e)}function s(t,e,r,a){let n,i,l,s;let c=[{x:Math.floor(t.x),y:Math.floor(t.y)}],h=Math.abs(e.y-t.y)>Math.abs(e.x-t.x);h?(n=Math.floor(t.y),i=Math.floor(t.x),l=Math.floor(e.y),s=Math.floor(e.x)):(n=Math.floor(t.x),i=Math.floor(t.y),l=Math.floor(e.x),s=Math.floor(e.y));let u=Math.abs(l-n),f=Math.abs(s-i),d=Math.floor(-u/2),y=n<l?1:-1,m=i<s?1:-1,g=!0;for(let t=n,e=i;t!==l+y;t+=y){let n=h?e:t,i=h?t:e;if(r.get(n,i)!==g&&(g=!g,c.push({x:n,y:i}),c.length===a+1))break;if((d+=f)>0){if(e===s)break;e+=m,d-=u}}let p=[];for(let t=0;t<a;t++)c[t]&&c[t+1]?p.push(o(c[t],c[t+1])):p.push(0);return p}function c(t,e,r,a){let n=e.y-t.y,i=e.x-t.x,o=s(t,e,r,Math.ceil(a/2)),l=s(t,{x:t.x-i,y:t.y-n},r,Math.ceil(a/2)),c=o.shift()+l.shift()-1;return l.concat(c).concat(...o)}function h(t,e){let r=l(t)/l(e),a=0;return e.forEach((e,n)=>{a+=(t[n]-e*r)**2}),{averageSize:r,error:a}}function u(t,e,r){try{let a=c(t,{x:-1,y:t.y},r,e.length),n=c(t,{x:t.x,y:-1},r,e.length),i={x:Math.max(0,t.x-t.y)-1,y:Math.max(0,t.y-t.x)-1},o=c(t,i,r,e.length),l={x:Math.min(r.width,t.x+t.y)+1,y:Math.min(r.height,t.y+t.x)+1},s=c(t,l,r,e.length),u=h(a,e),f=h(n,e),d=h(o,e),y=h(s,e),m=Math.sqrt(u.error*u.error+f.error*f.error+d.error*d.error+y.error*y.error),g=(u.averageSize+f.averageSize+d.averageSize+y.averageSize)/4,p=((u.averageSize-g)**2+(f.averageSize-g)**2+(d.averageSize-g)**2+(y.averageSize-g)**2)/g;return m+p}catch{return 1/0}}function f(t,e){let r=Math.round(e.x);for(;t.get(r,Math.round(e.y));)r--;let a=Math.round(e.x);for(;t.get(a,Math.round(e.y));)a++;let n=(r+a)/2,i=Math.round(e.y);for(;t.get(Math.round(n),i);)i--;let o=Math.round(e.y);for(;t.get(Math.round(n),o);)o++;let l=(i+o)/2;return{x:n,y:l}}function d(t,e,r,a,n){let i,s;try{({dimension:i,moduleSize:s}=function(t,e,r,a){let n=(l(c(t,r,a,5))/7+l(c(t,e,a,5))/7+l(c(r,t,a,5))/7+l(c(e,t,a,5))/7)/4;if(n<1)throw Error("Invalid module size");let i=Math.round(o(t,e)/n),s=Math.round(o(t,r)/n),h=Math.floor((i+s)/2)+7;switch(h%4){case 0:h++;break;case 2:h--}return{dimension:h,moduleSize:n}}(a,r,n,t))}catch(t){return null}let h={x:r.x-a.x+n.x,y:r.y-a.y+n.y},f=(o(a,n)+o(a,r))/2/s,d=1-3/f,y={x:a.x+d*(h.x-a.x),y:a.y+d*(h.y-a.y)},m=e.map(e=>{let r=(e.top.startX+e.top.endX+e.bottom.startX+e.bottom.endX)/4,a=(e.top.y+e.bottom.y+1)/2;if(!t.get(Math.floor(r),Math.floor(a)))return;let n=u({x:Math.floor(r),y:Math.floor(a)},[1,1,1],t),i=n+o({x:r,y:a},y);return{x:r,y:a,score:i}}).filter(t=>!!t).sort((t,e)=>t.score-e.score),g=f>=15&&m.length?m[0]:y;return{alignmentPattern:g,dimension:i}}function y(t,e,r,a){let n=t.x-e.x+r.x-a.x,i=t.y-e.y+r.y-a.y;if(0===n&&0===i)return{a11:e.x-t.x,a12:e.y-t.y,a13:0,a21:r.x-e.x,a22:r.y-e.y,a23:0,a31:t.x,a32:t.y,a33:1};{let o=e.x-r.x,l=a.x-r.x,s=e.y-r.y,c=a.y-r.y,h=o*c-l*s,u=(n*c-l*i)/h,f=(o*i-n*s)/h;return{a11:e.x-t.x+u*e.x,a12:e.y-t.y+u*e.y,a13:u,a21:a.x-t.x+f*a.x,a22:a.y-t.y+f*a.y,a23:f,a31:t.x,a32:t.y,a33:1}}}const m=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,1,1,1,0,1],[1,0,1,1,1,0,1],[1,0,1,1,1,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],g=[[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,1,1,1,1]];function p(t,r,a=65536){let{matrix:i,mappingFunction:o}=function(t,e){let r=function(t,e,r,a){let n=y(t,e,r,a);return{a11:n.a22*n.a33-n.a23*n.a32,a12:n.a13*n.a32-n.a12*n.a33,a13:n.a12*n.a23-n.a13*n.a22,a21:n.a23*n.a31-n.a21*n.a33,a22:n.a11*n.a33-n.a13*n.a31,a23:n.a13*n.a21-n.a11*n.a23,a31:n.a21*n.a32-n.a22*n.a31,a32:n.a12*n.a31-n.a11*n.a32,a33:n.a11*n.a22-n.a12*n.a21}}({x:3.5,y:3.5},{x:e.dimension-3.5,y:3.5},{x:e.dimension-6.5,y:e.dimension-6.5},{x:3.5,y:e.dimension-3.5}),a=y(e.topLeft,e.topRight,e.alignmentPattern,e.bottomLeft),i={a11:a.a11*r.a11+a.a21*r.a12+a.a31*r.a13,a12:a.a12*r.a11+a.a22*r.a12+a.a32*r.a13,a13:a.a13*r.a11+a.a23*r.a12+a.a33*r.a13,a21:a.a11*r.a21+a.a21*r.a22+a.a31*r.a23,a22:a.a12*r.a21+a.a22*r.a22+a.a32*r.a23,a23:a.a13*r.a21+a.a23*r.a22+a.a33*r.a23,a31:a.a11*r.a31+a.a21*r.a32+a.a31*r.a33,a32:a.a12*r.a31+a.a22*r.a32+a.a32*r.a33,a33:a.a13*r.a31+a.a23*r.a32+a.a33*r.a33},o=n.createEmpty(e.dimension,e.dimension),l=(t,e)=>{let r=i.a13*t+i.a23*e+i.a33;return{x:(i.a11*t+i.a21*e+i.a31)/r,y:(i.a12*t+i.a22*e+i.a32)/r}};for(let r=0;r<e.dimension;r++)for(let a=0;a<e.dimension;a++){let e=a+.5,n=r+.5,i=l(e,n);o.set(a,r,t.get(Math.floor(i.x),Math.floor(i.y)))}return{matrix:o,mappingFunction:l}}(r.binaryImage,r.location),l=m.length,s=0;for(let t=0;t<i.width-2*l-2;t++)s|=(i.get(l+2+t,l-1)?1:0)<<t;if(console.debug("Decoded contents side length:",s),s>a)throw Error("Detected program side length is too large: "+s+" > "+a);if(s<8)throw Error("Detected program side length is too small: "+s+" < 8");let c=s-2,h=i.width-(l+2)*2-1;if(h<c)throw Error("Virtual to pixels ratio is too small: "+h+" QR pixels with "+c+" codels");let u=h/c;console.debug("Scaling out by",u," -- ",h,c);let f=new e(c,c);for(let e=0;e<f.width;e++)for(let r=0;r<f.height;r++){let a=e*u,n=r*u,i=o(a+l+2,n+l+2),s=Math.floor(i.x),c=Math.floor(i.y),h=t.getPixel(s,c);f.setPixel(e,r,h)}return f}"use strict";var v={},b={lred:[0,0],lyellow:[0,1],lgreen:[0,2],lcyan:[0,3],lblue:[0,4],lmagenta:[0,5],red:[1,0],yellow:[1,1],green:[1,2],cyan:[1,3],blue:[1,4],magenta:[1,5],dred:[2,0],dyellow:[2,1],dgreen:[2,2],dcyan:[2,3],dblue:[2,4],dmagenta:[2,5],white:[-1,0],black:[-1,-1]};function x(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function w(t,e){var r=t[0].length,a=t.length;return e[0]<0||e[1]<0||e[0]>=a||e[1]>=r}function k(t,e){return!!w(t,e)||"black"===t[e[0]][e[1]]}function M(t,e){var r=function(t,e){for(var r=[],a=e[t.x][t.y],n=e[0].length,i=e.length,o=t.dp,l=t.cc,s=[[t.x,t.y]],c=[];s.length>0;){var h=s.shift();if(c.push(h),e[h[0]][h[1]]===a){if(r.push(h),0!==h[0]){var u=[h[0]-1,h[1]],f=!0,d=!0,y=!1,m=void 0;try{for(var g,p=c[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var v=g.value;if(x(v,u)){f=!1;break}}}catch(t){y=!0,m=t}finally{try{!d&&p.return&&p.return()}finally{if(y)throw m}}if(f){var b=!0,w=!1,k=void 0;try{for(var M,E=s[Symbol.iterator]();!(b=(M=E.next()).done);b=!0){var I=M.value;if(x(I,u)){f=!1;break}}}catch(t){w=!0,k=t}finally{try{!b&&E.return&&E.return()}finally{if(w)throw k}}}f&&s.push(u)}if(0!==h[1]){var S=[h[0],h[1]-1],L=!0,X=!0,P=!1,A=void 0;try{for(var z,T=c[Symbol.iterator]();!(X=(z=T.next()).done);X=!0){var C=z.value;if(x(C,S)){L=!1;break}}}catch(t){P=!0,A=t}finally{try{!X&&T.return&&T.return()}finally{if(P)throw A}}if(L){var R=!0,B=!1,O=void 0;try{for(var D,U=s[Symbol.iterator]();!(R=(D=U.next()).done);R=!0){var $=D.value;if(x($,S)){L=!1;break}}}catch(t){B=!0,O=t}finally{try{!R&&U.return&&U.return()}finally{if(B)throw O}}}L&&s.push(S)}if(h[0]!==i-1){var j=[h[0]+1,h[1]],W=!0,F=!0,N=!1,H=void 0;try{for(var V,q=c[Symbol.iterator]();!(F=(V=q.next()).done);F=!0){var _=V.value;if(x(_,j)){W=!1;break}}}catch(t){N=!0,H=t}finally{try{!F&&q.return&&q.return()}finally{if(N)throw H}}if(W){var Q=!0,G=!1,J=void 0;try{for(var K,Y=s[Symbol.iterator]();!(Q=(K=Y.next()).done);Q=!0){var Z=K.value;if(x(Z,j)){W=!1;break}}}catch(t){G=!0,J=t}finally{try{!Q&&Y.return&&Y.return()}finally{if(G)throw J}}}W&&s.push(j)}if(h[1]!==n-1){var tt=[h[0],h[1]+1],te=!0,tr=!0,ta=!1,tn=void 0;try{for(var ti,to=c[Symbol.iterator]();!(tr=(ti=to.next()).done);tr=!0){var tl=ti.value;if(x(tl,tt)){te=!1;break}}}catch(t){ta=!0,tn=t}finally{try{!tr&&to.return&&to.return()}finally{if(ta)throw tn}}if(te){var ts=!0,tc=!1,th=void 0;try{for(var tu,tf=s[Symbol.iterator]();!(ts=(tu=tf.next()).done);ts=!0){var td=tu.value;if(x(td,tt)){te=!1;break}}}catch(t){tc=!0,th=t}finally{try{!ts&&tf.return&&tf.return()}finally{if(tc)throw th}}}te&&s.push(tt)}}}var ty=r.length,tm=[-1,-1];switch(o%4){case 0:if("break"===function(){var t=-1,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;t=Math.max(t,s[1])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}if(1!==(r=r.filter(function(e){return e[1]===t})).length){if(l%2==0)!function(){var t=1/0,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var l=i.value;t=Math.min(t,l[0])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}r=r.filter(function(e){return e[0]===t})}();else{t=-1;var c=!0,h=!1,u=void 0;try{for(var f,d=r[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;t=Math.max(t,y[0])}}catch(t){h=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(h)throw u}}r=r.filter(function(e){return e[0]===t})}}return tm=r[0],tm[1]+=1,"break"}())break;case 1:if("break"===function(){var t=-1,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;t=Math.max(t,s[0])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}if(1!==(r=r.filter(function(e){return e[0]===t})).length){if(l%2==0){t=-1;var c=!0,h=!1,u=void 0;try{for(var f,d=r[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;t=Math.max(t,y[1])}}catch(t){h=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(h)throw u}}r=r.filter(function(e){return e[1]===t})}else!function(){var t=1/0,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var l=i.value;t=Math.min(t,l[1])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}r=r.filter(function(e){return e[1]===t})}()}return tm=r[0],tm[0]+=1,"break"}())break;case 2:if("break"===function(){var t=1/0,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;t=Math.min(t,s[1])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}if(1!==(r=r.filter(function(e){return e[1]===t})).length){if(l%2==0)!function(){var t=-1,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var l=i.value;t=Math.max(t,l[0])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}r=r.filter(function(e){return e[0]===t})}();else{t=1/0;var c=!0,h=!1,u=void 0;try{for(var f,d=r[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;t=Math.min(t,y[0])}}catch(t){h=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(h)throw u}}r=r.filter(function(e){return e[0]===t})}}return tm=r[0],tm[1]-=1,"break"}())break;case 3:if("break"===function(){var t=1/0,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;t=Math.min(t,s[0])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}if(1!==(r=r.filter(function(e){return e[0]===t})).length){if(l%2==0){t=1/0;var c=!0,h=!1,u=void 0;try{for(var f,d=r[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;t=Math.min(t,y[1])}}catch(t){h=!0,u=t}finally{try{!c&&d.return&&d.return()}finally{if(h)throw u}}r=r.filter(function(e){return e[1]===t})}else!function(){var t=-1,e=!0,a=!1,n=void 0;try{for(var i,o=r[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var l=i.value;t=Math.max(t,l[1])}}catch(t){a=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw n}}r=r.filter(function(e){return e[1]===t})}()}return tm=r[0],tm[0]-=1,"break"}())break;default:throw Error("never come!")}return tm[2]=ty,tm}(t,e);if(w(e,r))return r;var a=e[r[0]][r[1]];if(r.exec=!0,"white"===a)for(r.exec=!1;!w(e,r)&&"white"===e[r[0]][r[1]];)switch(t.dp%4){case 0:r[1]++;break;case 1:r[0]++;break;case 2:r[1]--;break;case 3:r[0]--;break;default:throw Error("never come!")}return r}function E(t){var e=t.env,r=t.code,a=M(e,r);if(t.step){if(k(r,a))return(e.unmovableCnt%2==0?++e.cc:++e.dp,++e.unmovableCnt,8===e.unmovableCnt)?(t.halt=!0,t):(a=M(e,r),e.nextCodel={x:a[0],y:a[1]},t);e.unmovableCnt=0}else{for(var n=!1,i=0;i<8;++i)if(k(r,a))i%2==0?e.cc++:e.dp++,a=M(e,r);else{n=!0;break}if(!n&&k(r,a))return t.halt=!0,t}var o=r[e.x][e.y],l=r[a[0]][a[1]];return e.area=a[2],a.exec&&function(t,e,r){if("white"!==e&&"white"!==r){var a=b[e],n=b[r],i=(n[0]-a[0]+3)%3;switch((n[1]-a[1]+6)%6){case 0:if(1===i){t.cmd="push",t.stack.push(t.area);return}if(2===i){t.cmd="pop",t.stack.pop();return}break;case 1:if(0===i){if(t.cmd="add",t.stack.length<2)return;var o=t.stack.pop(),l=t.stack.pop();t.stack.push(o+l);return}if(1===i){if(t.cmd="sub",t.stack.length<2)return;var s=t.stack.pop(),c=t.stack.pop();t.stack.push(c-s);return}if(2===i){if(t.cmd="mul",t.stack.length<2)return;var h=t.stack.pop(),u=t.stack.pop();t.stack.push(h*u);return}break;case 2:if(0===i){if(t.cmd="div",t.stack.length<2)return;var f=t.stack.pop(),d=t.stack.pop();0!==f?t.stack.push(d/f|0):(t.stack.push(d),t.stack.push(f));return}if(1===i){if(t.cmd="mod",t.stack.length<2)return;var y=t.stack.pop(),m=t.stack.pop();t.stack.push(0===m||0===y||m%y==0?0:m>0&&y>0||m<0&&y<0?m%y:m%y+y);return}if(2===i){if(t.cmd="not",t.stack.length<1)return;0===t.stack.pop()?t.stack.push(1):t.stack.push(0);return}break;case 3:if(0===i){if(t.cmd="greater",t.stack.length<2)return;var g=t.stack.pop();t.stack.pop()>g?t.stack.push(1):t.stack.push(0);return}if(1===i){if(t.cmd="pointer",t.stack.length<1)return;var p=t.stack.pop();t.dp+=p;return}if(2===i){if(t.cmd="switch",t.stack.length<1)return;var v=t.stack.pop();t.cc+=v;return}break;case 4:if(0===i){if(t.cmd="dup",t.stack.length<1)return;var x=t.stack.pop();t.stack.push(x),t.stack.push(x)}if(1===i){if(t.cmd="roll",t.stack.length<2)return;var w=t.stack.pop(),k=t.stack.pop();if(k<0||t.stack.length<k){t.stack.push(k),t.stack.push(w);return}for(var M=Array(k),E=0;E<k;++E)M[E]=t.stack.pop();for(var I=Array(k),S=0;S<k;++S)I[S]=M[(S+w)%k];for(var L=0;L<k;++L)t.stack.push(I.pop());return}if(2===i){t.cmd="in(n)";var X=parseInt(t.input.shift(),10);Number.isNaN(X)||t.stack.push(X);return}break;case 5:if(0===i){t.cmd="in(c)";var P=t.input.shift().charCodeAt(0);t.stack.push(P);return}if(1===i){if(t.cmd="out(n)",t.stack.length<1)return;var A=t.stack.pop();t.output+=A.toString();return}if(2===i){if(t.cmd="out(c)",t.stack.length<1)return;var z=t.stack.pop();t.output+=String.fromCharCode(z);return}break;default:throw Error("never come!")}}}(e,o,l),e.x=a[0],e.y=a[1],a=M(e,r),e.nextCodel={x:a[0],y:a[1]},t.halt=!1,t}function I(t,e,r){var a={};return a.x=a.y=a.dp=a.cc=a.area=0,a.unmovableCnt=0,a.stack=[],a.input=e||[],a.output="",{env:a,code:t,halt:!1,step:r}}v={next:E,run:function(t,e){return function(t){for(;!t.halt;)t=E(t);return t.env.output}(I(t,e))},create:I};const{create:S,next:L}=function(t){return t&&t.__esModule?t.default:t}(v),X={lred:"#ffc0c0",lyellow:"#ffffc0",lgreen:"#c0ffc0",lcyan:"#c0ffff",lblue:"#c0c0ff",lmagenta:"#ffc0ff",red:"#ff0000",yellow:"#ffff00",green:"#00ff00",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",dred:"#c00000",dyellow:"#c0c000",dgreen:"#00c000",dcyan:"#00c0c0",dblue:"#0000c0",dmagenta:"#c000c0",white:"#ffffff",black:"#000000"};function P(t){return S(function(t){let e,r=[],a=(e=Object.assign({},...Object.keys(X).map(t=>{var e,r;return{[t]:(e=X[t],(r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null)}})),(t,r,a)=>{let n=Object.keys(e).map(n=>{let i=e[n];return{name:n,dist:Math.sqrt((i.r-t)**2+(i.g-r)**2+(i.b-a)**2)}}),i=n.reduce((t,e)=>t.dist<e.dist?t:e);return i.name});for(let e=0;e<t.height;e++){r.push([]);for(let n=0;n<t.width;n++){let[i,o,l]=t.getPixel(n,e);r[e].push(a(i,o,l))}}return r}(t))}class A{constructor(t=0){this.steps=t}}async function z(t,e,r,a=1e4){let n=0,i=null;for(t.env.input={shift:()=>(i="in(c)"==t.env.cmd,"0")};!t.halt&&n++<a;){if(t=L(t),null!=i){let r=await e(i);t.env.stack.pop(),t.env.stack.push(r),i=null}if(t.env.output.length>0){let e=t.env.output;if("out(c)"==t.env.cmd)r(e[0]);else if("out(n)"==t.env.cmd)r(parseInt(e));else throw Error("Unknown output type: "+t.env.cmd);t.env.output=""}}return n>=a&&console.warn("Reached maximum number of steps"),new A(n)}async function T(t,e,r,a,n,i,o,l,s){let c,h;let u=await t.start();c=async()=>{await u.stop(),r.removeEventListener("click",h),a.removeEventListener("click",c)},a.addEventListener("click",c),r.setAttribute("disabled","true"),o.setAttribute("disabled","true"),h=async()=>{let c;r.setAttribute("disabled","true"),a.setAttribute("disabled","true"),n.style.display="flex",c=async()=>{n.style.display="none",s.removeEventListener("click",c),l.innerText="stopped",a.removeAttribute("disabled"),await u.stop(),await T(t,e,r,a,n,i,o,l,s)},s.addEventListener("click",c),l.innerText="running",i.innerText="",o.removeAttribute("disabled"),await U(i,o),l.innerText="completed",o.setAttribute("disabled","true")},r.addEventListener("click",h),await B(u,e,r)}let C=null,R=null;async function B(t,e,r){let a=await t.getFrame();e.width=a.width,e.height=a.height;let n=e.getContext("2d");if(n.putImageData(a,0,0),(R=await O(a))?(n.strokeStyle="red",n.lineWidth=2,n.beginPath(),n.moveTo(R.location.topLeft.x,R.location.topLeft.y),n.lineTo(R.location.topRight.x,R.location.topRight.y),n.lineTo(R.location.alignmentPattern.x,R.location.alignmentPattern.y),n.lineTo(R.location.bottomLeft.x,R.location.bottomLeft.y),n.lineTo(R.location.topLeft.x,R.location.topLeft.y),n.stroke(),r.removeAttribute("disabled")):r.setAttribute("disabled","true"),t.isVideo&&t.isOpen()){let a=R?1e3:100;setTimeout(async()=>await B(t,e,r),a)}}async function O(t){let r=e.fromImageWithAlpha(t.width,t.height,t.data);C=r;let a=Error("Program may be OK, as it is asking for input"),s=await D(function(t){let e=t.toImageWithAlpha(),r=function(t,e,r,a){if(t.length!==e*r*4)throw Error("Malformed data passed to binarizer.");let o=new i(e,r);for(let a=0;a<e;a++)for(let n=0;n<r;n++){let r=t[(n*e+a)*4+0],i=t[(n*e+a)*4+1],l=t[(n*e+a)*4+2];o.set(a,n,.2126*r+.7152*i+.0722*l)}let l=Math.ceil(e/8),s=Math.ceil(r/8),c=new i(l,s);for(let t=0;t<s;t++)for(let e=0;e<l;e++){let r=0,a=1/0,n=0;for(let i=0;i<8;i++)for(let l=0;l<8;l++){let s=o.get(8*e+l,8*t+i);r+=s,a=Math.min(a,s),n=Math.max(n,s)}let i=r/64;if(n-a<=24&&(i=a/2,t>0&&e>0)){let r=(c.get(e,t-1)+2*c.get(e-1,t)+c.get(e-1,t-1))/4;a<r&&(i=r)}c.set(e,t,i)}let h=n.createEmpty(e,r),u=null;a&&(u=n.createEmpty(e,r));for(let t=0;t<s;t++)for(let e=0;e<l;e++){var f,d,y,m;let r=(f=e,d=l-3,f<2?2:f>d?d:f),n=(y=t,m=s-3,y<2?2:y>m?m:y),i=0;for(let t=-2;t<=2;t++)for(let e=-2;e<=2;e++)i+=c.get(r+t,n+e);let g=i/25;for(let r=0;r<8;r++)for(let n=0;n<8;n++){let i=8*e+r,l=8*t+n,s=o.get(i,l);h.set(i,l,s<=g),a&&u.set(i,l,!(s<=g))}}return a?{binarized:h,inverted:u}:{binarized:h}}(e.data,e.width,e.height,!1),a=function(t){let e=[],r=[],a=[],n=[];for(let i=0;i<=t.height;i++){let o=0,s=!1,c=[0,0,0,0,0];for(let e=-1;e<=t.width;e++){let a=t.get(e,i);if(a===s)o++;else{c=[c[1],c[2],c[3],c[4],o],o=1,s=a;let t=l(c)/7,h=Math.abs(c[0]-t)<t&&Math.abs(c[1]-t)<t&&Math.abs(c[2]-3*t)<3*t&&Math.abs(c[3]-t)<t&&Math.abs(c[4]-t)<t&&!a,u=l(c.slice(-3))/3,f=Math.abs(c[2]-u)<u&&Math.abs(c[3]-u)<u&&Math.abs(c[4]-u)<u&&a;if(h){let t=e-c[3]-c[4],a=t-c[2],n={startX:a,endX:t,y:i},o=r.filter(e=>a>=e.bottom.startX&&a<=e.bottom.endX||t>=e.bottom.startX&&a<=e.bottom.endX||a<=e.bottom.startX&&t>=e.bottom.endX&&c[2]/(e.bottom.endX-e.bottom.startX)<1.5&&c[2]/(e.bottom.endX-e.bottom.startX)>.5);o.length>0?o[0].bottom=n:r.push({top:n,bottom:n})}if(f){let t=e-c[4],r=t-c[3],a={startX:r,y:i,endX:t},o=n.filter(e=>r>=e.bottom.startX&&r<=e.bottom.endX||t>=e.bottom.startX&&r<=e.bottom.endX||r<=e.bottom.startX&&t>=e.bottom.endX&&c[2]/(e.bottom.endX-e.bottom.startX)<1.5&&c[2]/(e.bottom.endX-e.bottom.startX)>.5);o.length>0?o[0].bottom=a:n.push({top:a,bottom:a})}}}e.push(...r.filter(t=>t.bottom.y!==i&&t.bottom.y-t.top.y>=2)),r=r.filter(t=>t.bottom.y===i),a.push(...n.filter(t=>t.bottom.y!==i)),n=n.filter(t=>t.bottom.y===i)}e.push(...r.filter(t=>t.bottom.y-t.top.y>=2)),a.push(...n);let i=e.filter(t=>t.bottom.y-t.top.y>=2).map(e=>{let r=(e.top.startX+e.top.endX+e.bottom.startX+e.bottom.endX)/4,a=(e.top.y+e.bottom.y+1)/2;if(!t.get(Math.round(r),Math.round(a)))return;let n=[e.top.endX-e.top.startX,e.bottom.endX-e.bottom.startX,e.bottom.y-e.top.y+1],i=l(n)/n.length,o=u({x:Math.round(r),y:Math.round(a)},[1,1,3,1,1],t);return{score:o,x:r,y:a,size:i}}).filter(t=>!!t).sort((t,e)=>t.score-e.score).map((t,e,r)=>{if(e>4)return null;let a=r.filter((t,r)=>e!==r).map(e=>({x:e.x,y:e.y,score:e.score+(e.size-t.size)**2/t.size,size:e.size})).sort((t,e)=>t.score-e.score);if(a.length<2)return null;let n=t.score+a[0].score+a[1].score;return{points:[t].concat(a.slice(0,2)),score:n}}).filter(t=>!!t).sort((t,e)=>t.score-e.score);if(0===i.length)return null;let{topRight:s,topLeft:c,bottomLeft:h}=function(t,e,r){let a,n,i;let l=o(t,e),s=o(e,r),c=o(t,r);return s>=l&&s>=c?[a,n,i]=[e,t,r]:c>=s&&c>=l?[a,n,i]=[t,e,r]:[a,n,i]=[t,r,e],(i.x-n.x)*(a.y-n.y)-(i.y-n.y)*(a.x-n.x)<0&&([a,i]=[i,a]),{bottomLeft:a,topLeft:n,topRight:i}}(i[0].points[0],i[0].points[1],i[0].points[2]),y=d(t,a,s,c,h),m=[];y&&m.push({alignmentPattern:{x:y.alignmentPattern.x,y:y.alignmentPattern.y},bottomLeft:{x:h.x,y:h.y},dimension:y.dimension,topLeft:{x:c.x,y:c.y},topRight:{x:s.x,y:s.y}});let g=f(t,s),p=f(t,c),v=f(t,h),b=d(t,a,g,p,v);return(b&&m.push({alignmentPattern:{x:b.alignmentPattern.x,y:b.alignmentPattern.y},bottomLeft:{x:v.x,y:v.y},topLeft:{x:p.x,y:p.y},topRight:{x:g.x,y:g.y},dimension:b.dimension}),0===m.length)?null:m}(r.binarized)||[];return console.debug("QR code locations:",JSON.stringify(a)),a.map(t=>({location:t,binaryImage:r.binarized}))}(r),async t=>{let e={steps:0};try{let n=p(r,t),i=P(n);if((e=await z(i,()=>{throw a},t=>{},1e3)).steps<1e3)return!0}catch(t){if(t===a){if(e.steps>5)return!0;t=Error("Program is asking for input in less than 5 steps, which is suspicious")}console.info("Ignoring possible program detection due to error:",t)}return!1});return 0===s.length?null:(console.warn("VALID PROGRAM DETECTED!"),s[0])}async function D(t,e){let r=Symbol();return(await Promise.all(t.map(async t=>await e(t)?t:r))).filter(t=>t!==r)}async function U(t,e){let r=C,a=R;if(!r||!a)return;let n=P(p(r,a)),i=await z(n,()=>{function r(){let t=e.value[0];return e.value=e.value.slice(1),t.charCodeAt(0)}return e.value.length>0?Promise.resolve(r()):new Promise(a=>{let n,i="<waiting for input...>";t.innerText+=i,n=()=>{e.removeEventListener("input",n),t.innerText=t.innerText.substring(0,t.innerText.length-i.length),a(r())},e.addEventListener("input",n)})},e=>{"number"==typeof e?t.innerText+="0x"+e.toString(16)+" ":t.innerText+=e},1e4);console.log(i),i.steps<1e4?console.log("Program executed successfully"):console.log("Program did not terminate")}const $=()=>({start:async()=>{if(!navigator.mediaDevices)throw alert("No media devices available (or this page is not served over HTTPS)"),Error("No media devices available (or this page is not served over HTTPS)");let t=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}});console.log(`Using video device: ${t.getTracks().map(t=>t.label).join(", ")}`);let e=document.createElement("video");e.style.display="none",e.srcObject=t,document.body.appendChild(e),await e.play();let r=document.createElement("canvas");r.style.display="none",r.width=e.videoWidth,r.height=e.videoHeight,r.setAttribute("willReadFrequently","true"),document.body.appendChild(r);let a=r.getContext("2d"),n=!0;return{srcObject:t,isVideo:!0,videoElement:e,getFrame:async()=>(a.drawImage(e,0,0,e.videoWidth,e.videoHeight),a.getImageData(0,0,e.videoWidth,e.videoHeight)),isOpen:()=>n,stop:()=>{n=!1,t.getTracks().forEach(t=>t.stop()),e.remove(),r.remove()}}}}),j=()=>{let t;return{start:()=>new Promise(e=>{if(t){r(void 0,t);return}{let e=document.createElement("input");e.style.display="none",e.type="file",e.accept="image/*",e.onchange=async()=>{let a=e.files[0];a&&(t=a,r(e,a))},e.click()}function r(t,r){let a=document.createElement("canvas");a.style.display="none";let n=a.getContext("2d"),i=new Image;i.onload=()=>{a.width=i.width,a.height=i.height,n.drawImage(i,0,0);let o=n.getImageData(0,0,i.width,i.height);e({srcObject:r,isOpen:()=>!1,isVideo:!1,videoElement:i,getFrame:async()=>o,stop:async()=>{t&&t.remove(),a.remove()}})},i.src=URL.createObjectURL(r)}})}};document.getElementById("create").addEventListener("click",function(){let n=document.createElement("input");n.style.display="none",n.type="file",n.accept="image/*",n.onchange=async()=>{let i=n.files[0];if(!i)return;let o=document.createElement("canvas");o.style.display="none";let l=o.getContext("2d"),s=new Image;s.onload=()=>{o.width=s.width,o.height=s.height,l.drawImage(s,0,0);let n=l.getImageData(0,0,s.width,s.height),c=e.fromImageWithAlpha(n.width,n.height,n.data);c=(function(n,i=1){let o=Math.max(n.width,n.height)+2;o=Math.max(o,8);let l=.1*o,s=Math.ceil(i*l),c=m.length+2;s=Math.ceil(s/c)*c;let h=s/c;t(s%c==0,"Locator size ("+s+") must be a multiple of "+c),t(h==Math.ceil(h),"Locator scale ("+h+") must be an integer"),console.debug("Locator size:",s,"scale:",h);let u=new e(o+2*s,o+2*s);for(let t=0;t<u.width;t++)for(let e=0;e<u.height;e++)t>=s&&t<u.width-s-2&&e>=s&&e<u.height-s-2?u.setPixel(t,e,r):u.setPixel(t,e,a);for(let t=0;t<2;t++)for(let e=0;e<2;e++){let a=t>0&&e>0,n=t*(u.width-s),i=e*(u.height-s);for(let t=-1;t<s;t++){let e=Math.floor(t/h);for(let o=-1;o<s;o++){let l=Math.floor(o/h),s=a?g:m,c=a?1:-1,f=e+c,d=l+c;f>=0&&f<s.length&&d>=0&&d<s[0].length&&1==s[f][d]&&u.setPixel(n+t,i+o,r)}}}for(let t=0;t<6;t++){let e=o>>t&1;u.setPixel(s+t+1,s-2,1==e?r:a)}for(let t=0;t<n.width;t++)for(let e=0;e<n.height;e++)u.setPixel(t+s,e+s,n.getPixel(t,e));return u})(c).toImageWithAlpha(),n=new ImageData(c.data,c.width,c.height),o.width=n.width,o.height=n.height,l.putImageData(n,0,0),o.toBlob(t=>{let e=document.createElement("a");e.download=i.name.replace(/\.[^/.]+$/,"")+"_cam.png",e.href=URL.createObjectURL(new Blob([t],{type:"image/png"})),e.click(),e.remove(),o.remove()})},s.src=URL.createObjectURL(i),n.remove()},n.click()});let W=document.getElementById("initial-screen"),F=document.getElementById("exe-screen"),N=document.getElementById("exe-overlay"),H=document.getElementById("exe-run"),V=document.getElementById("exe-cancel"),q=document.getElementById("exe-interpreter"),_=document.getElementById("exe-output"),Q=document.getElementById("exe-input"),G=document.getElementById("exe-interpreter-status"),J=document.getElementById("exe-back");async function K(t){W.style.display="none",F.style.display="flex",await T(t,N,H,V,q,_,Q,G,J)}H.setAttribute("disabled","true"),V.addEventListener("click",()=>{F.style.display="none",W.style.display="flex"}),document.getElementById("start-photo").addEventListener("click",async()=>await K(await j())),document.getElementById("start-video").addEventListener("click",async()=>await K(await $()));